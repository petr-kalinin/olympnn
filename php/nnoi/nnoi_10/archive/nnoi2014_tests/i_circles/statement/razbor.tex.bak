\input{circles.tex}

\solution

\begin{wrapfigure}{r}{6cm}
\includegraphics{razb.1}
\end{wrapfigure}

Будем называть полярным углом вектора угол между направлением оси $x$ и направлением этого вектора. 
Углы будем считать ориентированными: если от направления оси $x$ к направлению вектора
вращение происходит против часовой стрелки, то угол будем считать положительным, иначе отрицательным.
Полярный угол будем считать определенным с точностью до слагаемого, кратного $2\pi$ 
(здесь и далее все углы измеряем в радианах), т.е., например,
будем считать полярные углы $\pi/4-2\pi$, $\pi/4$ и $\pi/4+2\pi$ совпадающими.

Обозначим данные нам точки $A_1$, $A_2$, \dots, $A_n$. Обозначим полярный угол вектора 
$\overrightarrow{A_1A_2}$ как $\alpha_1$ (см. рис), полярный угол вектора $\overrightarrow{A_2A_3}$ 
как $\alpha_2$ и т.д.

Пусть у нас имеется некоторое решение задачи. Построим в каждой точке $A_i$ вектор, касательный к 
окружностям, и направленный по направлению движения от точки $A_i$ к $A_{i+1}$ (см. рис.); 
обозначим полярный угол этого вектора как~$\varphi_i$.

Из несложных геометрических соображений можно получить, что
$$
\varphi_{i+1}=2\alpha_i-\varphi_i.
$$

Тогда выразим все углы последовательно через $\varphi_1$:
$$
 \begin{aligned}
\varphi_2&=2\alpha_1-\varphi_1,\\
\varphi_3&=2\alpha_2-2\alpha_1+\varphi_1,\\
&\dots,\\
\varphi_{n+1}&=2(\alpha_n-\alpha_{n-1}+\dots\mp\alpha_1)\pm\varphi_1
\end{aligned}
$$
в последней строке выбор знака $+$ или $-$ зависит от четности $n$, а $\varphi_{n+1}$ обозначает 
полярный угол касательной к последней окружности в точке $A_1$.

Конечно, должно выполняться $\varphi_{n+1}=\varphi_1$, откуда получаем уравнение на $\varphi_1$:
$$
\varphi_1=2(\alpha_n-\alpha_{n-1}+\dots\mp\alpha_1)\pm\varphi_1.
$$

В случае нечетного $n$ в правой части перед $\varphi_1$ будет стоять знак $-$, откуда получаем
$$
2\varphi_1=2(\alpha_n-\alpha_{n-1}+\dots+\alpha_1).
$$

С учетом того, что все углы у нас определены с точностью до слагаемого, кратного $2\pi$, это 
уравнение имеет два решения:
$$
\varphi_1=\alpha_n-\alpha_{n-1}+\dots+\alpha_1\qquad\mbox{и}\quad\varphi_1=\alpha_n-\alpha_{n-1}+\dots+\alpha_1+\pi.
$$

Несложно показать, что оба этих решения дают решение задачи. А именно, исходя из $\varphi_1$ и 
$\alpha_1$ несложно вычисляется радиус дуги окружности, соединяющей $A_1$ и $A_2$ и дающей нужное значение 
$\varphi_1$, после чего эта дуга легко строится. Далее аналогично строится вторая дуга, и т.д.

Таким образом, при нечетном $n$ всегда существуют два решения (точнее, не совсем всегда, см. последний абзац разбора). Несложно заметить, что одно решение 
получается из другого заменой каждой дуги на ее дополнение до полной окружности.

В частности, при $n=3$ одно из решений "--- описанная вокруг треугольника окружность.

В случае же четного $n$ в правой части уравнения на $\varphi_1$ будет стоять знак $+$. В итоге, 
$\varphi_1$ уничтожится и останется равенство
$$
2(\alpha_n-\alpha_{n-1}+\dots-\alpha_1)=0.
$$

Очевидно, это условие существования решения: решение существует тогда и только тогда, когда 
равенство выполняется. При этом не следует забывать, что все углы у нас определены с точностью до 
слагаемого, кратного $2\pi$, т.е. это равенство следует понимать как условие, 
что знакочередующаяся сумма $\alpha_n-\alpha_{n-1}+\dots-\alpha_1$ кратна $\pi$.

(В частности, из этого условия следует, что при $n=4$ решение существует тогда и только тогда, 
когда данные четыре точки лежат на одной окружности.)

Более того, если это условие выполняется, то в качестве решения можно взять любое $\varphi_1$, и 
исходя из него построить решение аналогично описанному выше процессу.

Тонкости реализации алгоритма в этом разборе рассматриваться не будут. Отметим лишь, что если 
$\varphi_1$ будет выбрано неудачно, то при некотором $i$ окажется, что $\varphi_i=\alpha_i$ или $\varphi_i=\alpha_i+\pi$, и 
соответствующей окружности не будет существовать (она выродится в прямую). При четном $n$ это 
исправляется выбором другого $\varphi_1$ (а точнее, можно выбрать некоторое случайное $\varphi_1$ и 
с крайне высокой вероятностью этот выбор будет хорошим); а при нечетном $n$ такая ситуация 
невозможна по условию: решение здесь не существует, но при небольшом сдвиге точек появляется.

\input{code.tex}  